---
layout: post
title:  "CUDA Illegal Instruction Error And GTX1070"
date:   2023-07-25 12:32:45 +0330
categories:
---
# CUDA Illegal Instruction Error on GTX1070m
I have noticed some strange errors with the recent versions of CUDA with my GTX1070m GPU. I came across it when I was trying to train a model with recent versions of Tensorflow and CUDA. 

So far, my observations indicate that CUDA 10.1-Updat2 (and possibly the older versions) work correctly, while CUDA 11.2 and later cause CUDA kernel crashes and instability.
I have tested my GPU's VRAMs with Nvidia MODs MATs. None of the tests indicated a faulty memory channel. The interesting part is that when I used [cuda_memtest](https://github.com/ComputationalRadiationPhysics/cuda_memtest) on any of the instances with a recent CUDA version installed, memory mismatches were found.
It seems that the recent Nvidia drivers or CUDA runtimes are tweaking GPU and/or VRAM frequencies, or there is some sort of compiler bug when targeting an old architecture such as Pascal.

| **OS**           | **KERNEL**   | **TF**       | **TF PKG/REPO**              | **CUDA**       | **CUDNN** | **CUDA PKG/REPO** | **STATUS** |
|------------------|--------------|--------------|------------------------------|----------------|-----------|-------------------|------------|
|       ARCH       |       ?      |    2.12.0    | arch/extra (tensorflow-cuda) |      11.8      |    8.6    |     arch/extra    |   CRASHES  |
| UBUNTU 22.04 LTS |       ?      |    2.12.0    |         source, PyPI         |      11.8      |    8.6    |    deb (Nvidia)   |   CRASHES  |
| UBUNTU 20.04 LTS | 5.4.0-100-GE | 2.5.0~2.11.0 |             PyPI             |      11.2      |    8.1    |    deb (Nvidia)   |   CRASHES  |
| UBUNTU 18.04 LTS |  5.0.0-23-GE |     2.3.0    |             PyPI             | 10.1 - Update2 |    7.6    |    deb (Nvidia)   |  **WORKS** |


Anyways, I am still happy to be able to use my old GTX1070m for deep learning. Tensorflow 2.3 is not that old and still offers good compatibility with the more recent scripts targetting TF 2.13.

Moreover, to control the fan speeds of the CPU and GPU of my laptop on Linux, I use [MSI_Fan_Control](https://github.com/atharvalele/MSI_Fan_Control) with [this profile](https://gist.github.com/salehjg/133c6cede5a5e27d2599609f5747a112). With semi-fresh thermal pastes, it keeps the CPU/GPU temperatures below 72 degrees C.
